document.addEventListener("DOMContentLoaded",()=>{let h=document.getElementById("drop-zone"),k=document.getElementById("file-input"),V=document.getElementById("file-list"),M=document.getElementById("start-btn"),S=document.getElementById("clear-btn"),v=document.getElementById("file-count"),R=document.getElementById("file-item-template"),A=document.querySelectorAll(".tab"),F=document.getElementById("convert-settings"),Q=document.getElementById("compress-settings"),C=document.getElementById("global-format-select"),q=document.querySelectorAll('input[name="comp-mode"]'),y=document.getElementById("input-crf"),D=document.getElementById("input-size"),L=document.getElementById("input-percent"),P=document.getElementById("input-res"),$=[],J="convert",T=!1;["mp4","avi","mkv","mp3","wav","pdf","jpg","png"].forEach((G)=>{let H=document.createElement("option");H.value=G,H.textContent=G.toUpperCase(),C.appendChild(H)}),A.forEach((G)=>{G.addEventListener("click",()=>{if(A.forEach((H)=>H.classList.remove("active")),G.classList.add("active"),J=G.dataset.action,J==="convert")F.classList.remove("hidden"),Q.classList.add("hidden");else F.classList.add("hidden"),Q.classList.remove("hidden");w()})}),q.forEach((G)=>{G.addEventListener("change",(H)=>{switch(y.classList.add("hidden"),D.classList.add("hidden"),L.classList.add("hidden"),P.classList.add("hidden"),H.target.value){case"crf":y.classList.remove("hidden");break;case"size":D.classList.remove("hidden");break;case"percent":L.classList.remove("hidden");break;case"res":P.classList.remove("hidden");break}})});let B=document.getElementById("percent-slider"),I=document.getElementById("percent-val");B.addEventListener("input",(G)=>I.textContent=G.target.value),h.addEventListener("click",()=>k.click()),h.addEventListener("dragover",(G)=>{G.preventDefault(),h.style.borderColor="var(--accent)"}),h.addEventListener("dragleave",()=>{h.style.borderColor="var(--border)"}),h.addEventListener("drop",(G)=>{if(G.preventDefault(),h.style.borderColor="var(--border)",G.dataTransfer.files.length)U(G.dataTransfer.files)}),k.addEventListener("change",(G)=>{if(G.target.files.length)U(G.target.files);k.value=""});function U(G){if($.length===0)V.innerHTML="";Array.from(G).forEach((H)=>{let W=Math.random().toString(36).substring(7),_=R.content.cloneNode(!0).querySelector(".file-item");_.querySelector(".file-name").textContent=H.name,_.querySelector(".file-meta").textContent=x(H.size)+" â€¢ En attente",_.querySelector(".remove-btn").addEventListener("click",()=>Z(W)),V.appendChild(_),$.push({id:W,file:H,status:"pending",jobId:null,element:_,existing:!1})}),w()}function Z(G){let H=$.findIndex((W)=>W.id===G);if(H>-1){if($[H].element.remove(),$.splice(H,1),$.length===0)V.innerHTML='<div class="empty-state">Aucun fichier en attente</div>';w()}}S.addEventListener("click",()=>{$=[],V.innerHTML='<div class="empty-state">Aucun fichier en attente</div>',w()});function w(){v.textContent=`(${$.length})`;let G=$.some((W)=>W.file&&W.status==="pending"),H=J!=="convert"||!!C.value;M.disabled=!G||T||!H}function x(G){if(G===0)return"0 B";let H=1024,W=["B","KB","MB","GB"],K=Math.floor(Math.log(G)/Math.log(H));return parseFloat((G/Math.pow(H,K)).toFixed(1))+" "+W[K]}M.addEventListener("click",()=>{if(T||$.length===0)return;T=!0,M.disabled=!0,M.textContent="Traitement en cours...",z(0).catch(()=>{T=!1,M.textContent="Lancer le traitement",w()})});async function z(G){if(G>=$.length){T=!1,M.disabled=!1,M.textContent="Lancer le traitement",alert("Traitement de la file termine !");return}let H=$[G];if(H.status==="done"||H.status==="error"||H.existing){z(G+1);return}let W=H.element.querySelector(".file-meta"),K=H.element.querySelector(".progress-bar-fill");W.textContent="envoi...",K.style.width="25%";let _=new FormData;if(_.append("file",H.file),_.append("action",J),J==="convert")_.append("format",C.value);else{let Y=document.querySelector('input[name="comp-mode"]:checked').value;_.append("comp_mode",Y);let X="";if(Y==="crf")X={1:"low",2:"medium",3:"high"}[document.getElementById("crf-slider").value];else if(Y==="size")X=document.getElementById("target-size").value;else if(Y==="percent")X=document.getElementById("percent-slider").value;else if(Y==="res")X=document.getElementById("res-select").value;_.append("comp_value",X)}try{let Y=await fetch("/jobs",{method:"POST",body:_}),X=await Y.json();if(Y.ok)H.jobId=X.job_id,H.status="queued",K.style.width="35%",W.textContent="en attente...",await c(H);else throw Error(X.error)}catch(Y){H.status="error",K.style.backgroundColor="var(--danger)",W.textContent="Erreur: "+Y.message,W.style.color="var(--danger)"}z(G+1)}async function c(G){let H=G.element.querySelector(".file-meta"),W=G.element.querySelector(".progress-bar-fill"),K=G.jobId;if(!K)return;while(!0){let _=await fetch(`/jobs/${K}`),Y=await _.json();if(!_.ok)throw Error(Y.error||"erreur");if(Y.status==="queued")H.textContent="en attente...",W.style.width="40%";else if(Y.status==="processing")H.textContent="traitement...",W.style.width="70%";else if(Y.status==="done"){G.status="done",W.style.width="100%",W.style.backgroundColor="var(--success)",H.textContent="termine",H.style.color="var(--success)";let X=G.element.querySelector(".download-btn");if(X.href=Y.download_url,X.classList.remove("hidden"),Y.output_filename)X.setAttribute("download",Y.output_filename);G.element.querySelector(".remove-btn").remove();return}else if(Y.status==="error"){G.status="error",W.style.backgroundColor="var(--danger)",H.textContent="erreur: "+(Y.error||"erreur"),H.style.color="var(--danger)";return}await j(1000)}}function j(G){return new Promise((H)=>setTimeout(H,G))}async function E(){try{let G=await fetch("/jobs?limit=100"),H=await G.json();if(!G.ok)return;let W=H.jobs||[];if(!W.length)return;if($.length===0)V.innerHTML="";W.reverse().forEach((K)=>{let _=`job_${K.id}`,X=R.content.cloneNode(!0).querySelector(".file-item");X.querySelector(".file-name").textContent=K.original_filename||K.id,X.querySelector(".file-meta").textContent=f(K.status,K.error);let O=X.querySelector(".progress-bar-fill"),g=X.querySelector(".file-meta");if(K.status==="done"){O.style.width="100%",O.style.backgroundColor="var(--success)",g.style.color="var(--success)";let N=X.querySelector(".download-btn");if(N.href=K.download_url,N.classList.remove("hidden"),K.output_filename)N.setAttribute("download",K.output_filename);X.querySelector(".remove-btn").remove()}else if(K.status==="processing")O.style.width="70%";else if(K.status==="queued")O.style.width="40%";else if(K.status==="error")O.style.width="100%",O.style.backgroundColor="var(--danger)",g.style.color="var(--danger)";X.querySelector(".remove-btn").addEventListener("click",()=>Z(_)),V.appendChild(X),$.push({id:_,file:null,status:K.status,jobId:K.id,element:X,existing:!0})}),w()}catch(G){}}function f(G,H){if(G==="queued")return"en attente";if(G==="processing")return"traitement";if(G==="done")return"termine";if(G==="error")return"erreur: "+(H||"erreur");return G||"etat inconnu"}E().catch(()=>{})});

//# debugId=5F2D13D76D64E12B64756E2164756E21
//# sourceMappingURL=script.js.map
